<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="template/ui.xhtml">
	<ui:define name="body">
		<ui:include src="./general/menutab.xhtml" />
		<div class="buildingManagementDiv">
				<table width="100%" class="appDivClass">
					<tr>
						<td>
							<div align="center" class="titleDivClass">
								<p:outputLabel value="Building Management"></p:outputLabel>
							</div>
							<hr />
						</td>
					</tr>
					<tr>
						<td width="100%">
							<div align="left" class="mainDivClass">
								<p:commandLink value="Add Building" styleClass="commonLink" onclick="PF('newBuildingPopup').show()"></p:commandLink>
								<br/>
								<br/>
								<h:form id="buildingManagementForm">
								<p:dataTable id="paginatorSelector"
									widgetVar="paginatorSelector" paginator="true"
									paginatorPosition="bottom"
									paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
									value="#{buildingManagementBean.buildingsToShow}" rows="10"
									rowKey="#{building.buildingId}" var="building"
									styleClass="buildingManagementTable">
									<p:column styleClass="dataTableColumn">
										<p:panel widgetVar="buildingPanelDivision" styleClass="buildingPanelClass">
											<div align="left" class="buildingDivClass">
												<table border="0" class="buildingManagDelete">
													<tr>
														<td valign="top" align="left">
															<h:outputText value="#{building.name}" styleClass="buildingName"></h:outputText>
															<br/>
															<h:outputText value="#{building.location}" styleClass="buildingLocation"></h:outputText>	
														</td>
														<td valign="top" align="right">
															<p:graphicImage width="15" styleClass="buildingManagIconClass" value="#{request.contextPath}/../resources/images/error.png"></p:graphicImage>
															<p:spacer width="5"/>
															<p:commandLink value="Delete" ajax="false" action="#{buildingManagementBean.deleteBuilding(building)}"></p:commandLink>
														</td>
													</tr>
												</table>
												<hr/>
												<div class="buildingDivClass" align="left">
													<h:panelGrid columns="2">
														<p:column>
<!-- 															 <p:multiSelectListbox value="#{multiSelectView.selection}" effect="slide" header="Categories" showHeaders="true"> -->
<!-- 														        <f:selectItems value="#{multiSelectView.categories}" /> -->
<!-- 														    </p:multiSelectListbox> -->
															<p:tree value="#{building.mainDivision}" var="division" styleClass="divisionAnalysis"
														                        id="divisionTreeAnalisys" selectionMode="checkbox" dynamic="true">
														        <p:treeNode styleClass="divisionAnalysisNode">
														            <h:outputText styleClass="treeDivisionText" value="#{division.name}"/>
														        </p:treeNode>
														        <f:attribute name="building" value="#{building}" />
														        <p:ajax event="select" listener="#{buildingManagementBean.showDivisionOptions}" update="@form" ></p:ajax>
														        <p:ajax event="unselect" listener="#{buildingManagementBean.hideDivisionOptions}" update="@form" ></p:ajax>
														    </p:tree>
														    <p:spacer height="15"></p:spacer>
														    <p:outputPanel rendered="#{building.mainDivisionIsSelected}" >
														    	<div align="center" class="divisionOptions">
														    		<p:commandLink oncomplete="PF('newDivisionPopup').show()" ajax="true" update=":newDivisionFormId">
																		<p:graphicImage value="#{request.contextPath}/../resources/images/plus.png"/>
																	</p:commandLink>
															    	<p:spacer width="5"/>
															    	<p:commandLink action="#{buildingManagementBean.deleteDivision}"
															    		oncomplete="	if (args.cantDeleteDivision=== true )
																						{ 
																							PF('unSuccessPanelcantDeleteDivision').show();
																						}
																						else if (args.nodeSelectedNull === true)
																						{
																							PF('unSuccessPanelnodeSelectedNull').show();
																						}
																						else PF('successPaneldeleteDivisionPopup').show()">
															    		<p:graphicImage value="#{request.contextPath}/../resources/images/negative.png"/>
																	</p:commandLink>
														    	</div>
														    </p:outputPanel>
														</p:column>
														<p:column>
															<p:outputLabel value="Analyzers"></p:outputLabel>
<!-- 															 <p:selectManyMenu id="advanced" value="#{selectManyView.selectedThemes}" converter="themeConverter" -->
<!-- 													                          var="t" filter="true" filterMatchMode="contains" showCheckbox="true"> -->
<!-- 													            <f:selectItems value="#{selectManyView.themes}" var="theme" itemLabel="#{theme.displayName}" itemValue="#{theme}" /> -->
													 
<!-- 													            <p:column> -->
<!-- 													                <h:graphicImage name="showcase/images/themeswitcher/themeswitcher-#{t.name}.png" alt="#{t.name}" styleClass="ui-theme" /> -->
<!-- 													            </p:column> -->
													             
<!-- 													            <p:column> -->
<!-- 													                <h:outputText value="#{t.displayName}" /> -->
<!-- 													            </p:column> -->
<!-- 													        </p:selectManyMenu> -->
														</p:column>
												    </h:panelGrid>
												</div>
											</div>
										</p:panel>
									</p:column>
								</p:dataTable>
								</h:form>
							</div>
						</td>
					</tr>
				</table>
				<br/>
				<br/>
		</div>
		<ui:include src="./general/footer.xhtml" />
		<ui:include src="./popups/newBuildingPopup.xhtml" />
		<ui:include src="./popups/newDivisionPopup.xhtml" >
			<ui:param name="parentDivision" value="#{buildingManagementBean.parentDivisionSelected.data.name}" />
		</ui:include>
		<ui:include src="./popups/unSuccessDialog.xhtml">
			<ui:param name="idUnsuccess" value="cantDeleteDivision" />
			<ui:param name="unSuccessMessage" value="Cant Delete this Division!" />
		</ui:include>
		<ui:include src="./popups/unSuccessDialog.xhtml">
			<ui:param name="idUnsuccess" value="nodeSelectedNull" />
			<ui:param name="unSuccessMessage" value="Please select a node first, before deleting!" />
		</ui:include>
		<ui:include src="./popups/successDialog.xhtml">
			<ui:param name="id" value="deleteDivisionPopup" />
			<ui:param name="successMessage"
				value="The division was deleted successfully!" />
			<ui:param name="path" value="buildingManagement.xhtml?faces-redirect=true" />
		</ui:include>
	</ui:define>
</ui:composition>