<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="template/ui.xhtml">
	<ui:define name="body">
		<ui:include src="./general/menutab.xhtml" />
		<div class="buildingManagementDiv">
				<table width="100%" class="appDivClass">
					<tr>
						<td>
							<div align="center" class="titleDivClass">
								<p:outputLabel value="Building Management"></p:outputLabel>
							</div>
							<hr />
						</td>
					</tr>
					<tr>
						<td width="100%">
							<div align="left" class="mainDivClass">
								<p:commandLink value="Create Building" styleClass="commonLink" onclick="PF('newBuildingPopup').show()"></p:commandLink>
								<p:spacer width="10"/>
								<p:commandLink value="Add Building" styleClass="commonLink" onclick="PF('newBuildingPopup').show()"></p:commandLink>
								<br/>
								<br/>
								<h:form id="buildingManagementForm">
								<p:dataTable id="paginatorSelector"
									widgetVar="paginatorSelector" paginator="true"
									paginatorPosition="bottom"
									paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
									value="#{buildingManagementBean.buildingsToShow}" rows="10"
									rowKey="#{building.buildingId}" var="building"
									styleClass="buildingManagementTable">
									<p:column styleClass="dataTableColumn">
										<p:panel widgetVar="buildingPanelDivision" styleClass="buildingPanelClass">
											<div align="left" class="buildingDivClass">
												<h:outputText value="#{building.name}" style="font-size:16px"></h:outputText>
												<br/>
												<h:outputText value="#{building.location}" styleClass="buildingLocation"></h:outputText>	
												<br/>		
												<div class="buildingDivClass" style="padding: 5px" align="left">
													<p:panel>
														 <p:tree value="#{building.mainDivision}" var="division" styleClass="divisionAnalysis"
													                        id="divisionTreeAnalisys" selectionMode="checkbox" dynamic="true">
													        <p:treeNode>
													            <h:outputText style="font-size: 12px" value="#{division.name}"/>
													        </p:treeNode>
													        <f:attribute name="building" value="#{building}" />
													        <p:ajax event="select" listener="#{buildingManagementBean.showDivisionOptions}" update="@form" ></p:ajax>
													        <p:ajax event="unselect" listener="#{buildingManagementBean.hideDivisionOptions}" update="@form" ></p:ajax>
													    </p:tree>
													    <p:spacer height="10"></p:spacer>
													    <p:outputPanel rendered="#{building.mainDivisionIsSelected}"  styleClass="divisionOptions">
													    	<div align="center">
													    		<p:commandLink oncomplete="PF('newDivisionPopup').show()" ajax="true" update=":newDivisionFormId">
																	<p:graphicImage value="#{request.contextPath}/../resources/images/plus.png"/>
																</p:commandLink>
														    	<p:spacer width="5"/>
														    	<p:commandLink action="#{buildingManagementBean.deleteDivision}" 
														    		ajax="true" update=":newDivisionFormId"
														    		oncomplete="	if (args.cantDeleteDivision=== true )
																					{ 
																						PF('unSuccessPanelcantDeleteDivision').show();
																					}
																					if (args.nodeSelectedNull === true)
																					{
																						PF('unSuccessPanelnodeSelectedNull').show();
																					}">
														    		<p:graphicImage value="#{request.contextPath}/../resources/images/negative.png"/>
																</p:commandLink>
													    	</div>
													    </p:outputPanel>
												    </p:panel>
												</div>
											</div>
											<br/>
											<div align="right" class="buildingManagDelete">
												<p:graphicImage width="15" styleClass="buildingManagIconClass" value="#{request.contextPath}/../resources/images/error.png"></p:graphicImage>
												<p:spacer width="5"/>
												<p:commandLink value="Delete" ajax="false" action="#{buildingManagementBean.deleteBuilding(building)}"></p:commandLink>
											</div>
										</p:panel>
									</p:column>
								</p:dataTable>
								</h:form>
							</div>
						</td>
					</tr>
				</table>
				<br/>
				<br/>
		</div>
		<ui:include src="./general/footer.xhtml" />
		<ui:include src="./popups/newBuildingPopup.xhtml" />
		<ui:include src="./popups/newDivisionPopup.xhtml" >
			<ui:param name="parentDivision" value="#{buildingManagementBean.parentDivisionSelected.data.name}" />
		</ui:include>
		<ui:include src="./popups/unSuccessDialog.xhtml">
			<ui:param name="idUnsuccess" value="cantDeleteDivision" />
			<ui:param name="unSuccessMessage" value="Cant Delete this Division!" />
		</ui:include>
		<ui:include src="./popups/unSuccessDialog.xhtml">
			<ui:param name="idUnsuccess" value="nodeSelectedNull" />
			<ui:param name="unSuccessMessage" value="Please select a node first, before deleting!" />
		</ui:include>
	</ui:define>
</ui:composition>